---
 - hosts: all
   tasks:
        - dnf: name={{ item }} state=present
          with_items:
                - ganglia-gmond
                - ganglia-gmond-python
                - libselinux-python
                - libselinux-python3

        - shell: firewall-cmd --add-port=8649/udp
        - shell: firewall-cmd --add-port=8649/udp --permanent
        - shell: firewall-cmd --add-port=8649/tcp
        - shell: firewall-cmd --add-port=8649/tcp --permanent

        - copy:
                src: gmond.conf
                dest: /etc/ganglia/gmond.conf
                backup: yes
                validate: sed -i 's/#HOSTNAME#/{{ ansible_hostname }}/' %s

        - systemd:
                name: gmond
                enabled: yes
                state: restarted
